# üìö RAG PDF QA System

> **H·ªá th·ªëng h·ªèi ƒë√°p t√†i li·ªáu PDF th√¥ng minh** s·ª≠ d·ª•ng ki·∫øn tr√∫c **RAG (Retrieval-Augmented Generation)** v·ªõi **FastAPI + Google Gemini AI + FAISS**. ·ª®ng d·ª•ng web hi·ªán ƒë·∫°i cho ph√©p t·∫£i l√™n t√†i li·ªáu PDF v√† ƒë·∫∑t c√¢u h·ªèi b·∫±ng ti·∫øng Vi·ªát, nh·∫≠n c√¢u tr·∫£ l·ªùi ch√≠nh x√°c k√®m tr√≠ch d·∫´n ngu·ªìn chi ti·∫øt.

---

## üåü Gi·ªõi thi·ªáu t·ªïng quan

RAG PDF QA System l√† m·ªôt ·ª©ng d·ª•ng web ƒë∆∞·ª£c x√¢y d·ª±ng ƒë·ªÉ gi·∫£i quy·∫øt b√†i to√°n h·ªèi ƒë√°p tr√™n t√†i li·ªáu PDF m·ªôt c√°ch th√¥ng minh v√† hi·ªáu qu·∫£. H·ªá th·ªëng k·∫øt h·ª£p c√¥ng ngh·ªá AI ti√™n ti·∫øn v·ªõi giao di·ªán ng∆∞·ªùi d√πng tr·ª±c quan, cho ph√©p:

- **T∆∞∆°ng t√°c t·ª± nhi√™n** v·ªõi t√†i li·ªáu PDF b·∫±ng ng√¥n ng·ªØ t·ª± nhi√™n
- **Tr√≠ch xu·∫•t th√¥ng tin ch√≠nh x√°c** v·ªõi tr√≠ch d·∫´n ngu·ªìn r√µ r√†ng
- **X·ª≠ l√Ω ƒëa t√†i li·ªáu** v·ªõi kh·∫£ nƒÉng qu·∫£n l√Ω session ri√™ng bi·ªát
- **T·ªëi ∆∞u hi·ªáu nƒÉng** v·ªõi h·ªá th·ªëng cache th√¥ng minh
- **H·ªó tr·ª£ OCR** cho c√°c t√†i li·ªáu scan/·∫£nh

H·ªá th·ªëng ƒë·∫∑c bi·ªát ph√π h·ª£p cho vi·ªác h·ªçc t·∫≠p, nghi√™n c·ª©u, v√† x·ª≠ l√Ω t√†i li·ªáu trong m√¥i tr∆∞·ªùng doanh nghi·ªáp.

---

## üèóÔ∏è Ki·∫øn tr√∫c & C√¥ng ngh·ªá ch√≠nh

### Ki·∫øn tr√∫c h·ªá th·ªëng

```mermaid
flowchart TB
    subgraph "Frontend"
        UI[Web Interface<br/>Bootstrap + Vanilla JS]
    end
    
    subgraph "Backend API"
        API[FastAPI<br/>RESTful Endpoints]
        ROUTES[Routes Layer<br/>upload, ingest, ask]
    end
    
    subgraph "RAG Engine"
        LOADER[PDF Loader<br/>pypdfium2 + OCR]
        CHUNK[Text Chunking<br/>Token-aware splitting]
        EMBED[Embeddings<br/>Gemini API]
        VECTOR[Vector Store<br/>FAISS/Chroma]
        SEARCH[Hybrid Search<br/>BM25 + Vector + MMR]
        RERANK[Reranker<br/>BGE CrossEncoder]
        GEN[Generator<br/>Gemini 1.5 Flash]
    end
    
    subgraph "Storage & Cache"
        FILES[File Storage<br/>Session-based]
        VCACHE[Vector Cache<br/>SQLite]
        ACACHE[Answer Cache<br/>SQLite]
    end
    
    UI --> API
    API --> ROUTES
    ROUTES --> LOADER
    LOADER --> CHUNK
    CHUNK --> EMBED
    EMBED --> VECTOR
    VECTOR --> SEARCH
    SEARCH --> RERANK
    RERANK --> GEN
    
    EMBED -.-> VCACHE
    GEN -.-> ACACHE
    LOADER -.-> FILES
```

### C√¥ng ngh·ªá s·ª≠ d·ª•ng

#### Backend Framework
- **FastAPI**: High-performance async web framework
- **Uvicorn**: ASGI server v·ªõi kh·∫£ nƒÉng scale cao
- **Pydantic**: Data validation v√† serialization

#### AI & Machine Learning
- **Google Gemini API**: 
  - `text-embedding-004` cho embeddings
  - `gemini-1.5-flash` cho text generation
- **FAISS**: Facebook AI Similarity Search - vector database
- **BGE Reranker**: Cross-encoder cho re-ranking k·∫øt qu·∫£
- **BM25**: Sparse retrieval algorithm
- **MMR**: Maximal Marginal Relevance cho ƒëa d·∫°ng h√≥a

#### Document Processing
- **pypdfium2**: PDF text extraction
- **Tesseract OCR**: Optical Character Recognition
- **tiktoken**: Token counting v√† chunking

#### Frontend
- **Bootstrap 5**: Responsive UI framework
- **Vanilla JavaScript**: Lightweight client-side logic
- **Jinja2**: Server-side templating

#### Storage & Caching
- **SQLite**: Local database cho cache
- **File System**: Session-based file management

---

## ‚ú® T√≠nh nƒÉng n·ªïi b·∫≠t

### üîÑ Quy tr√¨nh x·ª≠ l√Ω t√†i li·ªáu
- **Upload ƒëa file**: H·ªó tr·ª£ t·∫£i l√™n ƒë·∫øn 5 file PDF c√πng l√∫c (‚â§ 10MB/file)
- **Ki·ªÉm tra t√≠nh h·ª£p l·ªá**: Validation MIME type v√† ch·ªØ k√Ω PDF
- **OCR t√≠ch h·ª£p**: X·ª≠ l√Ω t√†i li·ªáu scan/·∫£nh v·ªõi Tesseract
- **Text chunking th√¥ng minh**: Token-aware splitting (300-500 tokens, overlap 10-15%)
- **Lo·∫°i b·ªè noise**: T·ª± ƒë·ªông ph√°t hi·ªán v√† lo·∫°i b·ªè header/footer l·∫∑p

### üîç C√¥ng c·ª• t√¨m ki·∫øm n√¢ng cao
- **Hybrid Search**: K·∫øt h·ª£p BM25 (sparse) v√† Vector search (dense)
- **MMR (Maximal Marginal Relevance)**: ƒêa d·∫°ng h√≥a k·∫øt qu·∫£ t√¨m ki·∫øm
- **Reranking**: BGE cross-encoder ƒë·ªÉ c·∫£i thi·ªán ƒë·ªô ch√≠nh x√°c
- **Confidence scoring**: ƒê√°nh gi√° ƒë·ªô tin c·∫≠y c·ªßa c√¢u tr·∫£ l·ªùi

### üß† Sinh tr·∫£ l·ªùi th√¥ng minh
- **Context-aware generation**: S·ª≠ d·ª•ng Gemini 1.5 Flash
- **Tr√≠ch d·∫´n b·∫Øt bu·ªôc**: Format [doc:page] cho m·ªçi th√¥ng tin
- **Guardrail**: Ch·ªâ tr·∫£ l·ªùi d·ª±a tr√™n n·ªôi dung t√†i li·ªáu
- **ƒêa ng√¥n ng·ªØ**: T·ªëi ∆∞u cho ti·∫øng Vi·ªát

### üöÄ T·ªëi ∆∞u hi·ªáu nƒÉng
- **Multi-layer caching**: 
  - Embedding cache (SHA1-based)
  - Answer cache (query + document set)
- **Concurrent processing**: Thread pool cho embedding generation
- **Session management**: C√°ch ly d·ªØ li·ªáu theo ng∆∞·ªùi d√πng
- **Rate limiting**: B·∫£o v·ªá API endpoints

### üõ°Ô∏è B·∫£o m·∫≠t & Monitoring
- **Input validation**: Ki·ªÉm tra k√≠ch th∆∞·ªõc, format, n·ªôi dung
- **File sanitization**: L√†m s·∫°ch t√™n file v√† ƒë∆∞·ªùng d·∫´n
- **Structured logging**: Chi ti·∫øt ho·∫°t ƒë·ªông h·ªá th·ªëng
- **Error handling**: X·ª≠ l√Ω ngo·∫°i l·ªá to√†n di·ªán
- **Health checks**: Monitoring endpoint

---

## üîß C√†i ƒë·∫∑t & Thi·∫øt l·∫≠p

### Y√™u c·∫ßu h·ªá th·ªëng

#### M√¥i tr∆∞·ªùng t·ªëi thi·ªÉu
- **Python**: 3.10 - 3.12
- **RAM**: ‚â• 4GB (khuy·∫øn ngh·ªã 8GB)
- **Storage**: ‚â• 2GB tr·ªëng
- **OS**: Windows 10+, macOS 11+, Ubuntu 20.04+

#### Dependencies ch√≠nh
- **Google Gemini API Key**: T·ª´ [Google AI Studio](https://aistudio.google.com/)
- **Tesseract OCR** (tu·ª≥ ch·ªçn): Cho x·ª≠ l√Ω PDF scan

### H∆∞·ªõng d·∫´n c√†i ƒë·∫∑t chi ti·∫øt

#### B∆∞·ªõc 1: Clone v√† setup m√¥i tr∆∞·ªùng
```bash
# Clone repository
git clone https://github.com/dungle03/rag-pdf.git
cd rag-pdf

# T·∫°o m√¥i tr∆∞·ªùng ·∫£o
python -m venv .venv

# K√≠ch ho·∫°t m√¥i tr∆∞·ªùng ·∫£o
# Windows PowerShell:
.\.venv\Scripts\Activate.ps1
# macOS/Linux:
source .venv/bin/activate

# C√†i ƒë·∫∑t dependencies
pip install -r requirements.txt
```

#### B∆∞·ªõc 2: C·∫•u h√¨nh m√¥i tr∆∞·ªùng (.env)

T·∫°o file `.env` t·ª´ template:
```bash
cp .env.example .env
```

Ch·ªânh s·ª≠a file `.env`:
```ini
# === AI Models ===
GEMINI_API_KEY=your_actual_api_key_here
RAG_EMBED_MODEL=text-embedding-004
RAG_LLM_MODEL=gemini-1.5-flash
EMBED_DIM=768

# === Retrieval Settings ===
HYBRID_ON=true
HYBRID_ALPHA=0.5
RETRIEVE_TOP_K=12
CONTEXT_K=6
MMR_LAMBDA=0.5

# === Reranking (Optional) ===
RERANK_ON=true

# === Generation ===
GENERATE_MIN_SIM=0.20

# === Storage ===
VECTOR_STORE=faiss
PERSIST_DIR=./storage
ENABLE_EMBED_CACHE=true
ENABLE_ANSWER_CACHE=true

# === File Upload ===
MAX_FILES=5
MAX_FILE_MB=10

# === OCR (Optional) ===
TESSERACT_CMD=C:\Program Files\Tesseract-OCR\tesseract.exe
OCR_LANG=vie+eng
```

#### B∆∞·ªõc 3: C√†i ƒë·∫∑t OCR (Tu·ª≥ ch·ªçn)

**Windows:**
1. T·∫£i [Tesseract OCR](https://github.com/UB-Mannheim/tesseract/wiki)
2. C√†i ƒë·∫∑t v√†o `C:\Program Files\Tesseract-OCR\`
3. ƒê∆∞·ªùng d·∫´n trong `.env` s·∫Ω t·ª± ƒë·ªông kh·ªõp

**macOS:**
```bash
brew install tesseract
```

**Ubuntu/Debian:**
```bash
sudo apt-get install tesseract-ocr tesseract-ocr-vie
```

#### B∆∞·ªõc 4: C√†i ƒë·∫∑t Reranker (Tu·ª≥ ch·ªçn)

ƒê·ªÉ tƒÉng ƒë·ªô ch√≠nh x√°c (tƒÉng th·ªùi gian x·ª≠ l√Ω):
```bash
# C√†i ƒë·∫∑t PyTorch (CPU version)
pip install torch --index-url https://download.pytorch.org/whl/cpu

# Sentence Transformers cho reranking
pip install sentence-transformers
```

---

## üöÄ H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng

### Kh·ªüi ƒë·ªông h·ªá th·ªëng

```bash
# Development mode (auto-reload)
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

# Production mode
uvicorn app.main:app --host 0.0.0.0 --port 8000 --workers 4
```

Truy c·∫≠p ·ª©ng d·ª•ng t·∫°i: `http://localhost:8000`

### Quy tr√¨nh s·ª≠ d·ª•ng c∆° b·∫£n

#### 1. Upload t√†i li·ªáu PDF
- K√©o th·∫£ ho·∫∑c ch·ªçn file PDF (t·ªëi ƒëa 5 file, 10MB/file)
- H·ªá th·ªëng t·ª± ƒë·ªông validate v√† hi·ªÉn th·ªã danh s√°ch file
- File ƒë∆∞·ª£c l∆∞u trong session ri√™ng bi·ªát

#### 2. X·ª≠ l√Ω v√† Vector h√≥a (Ingest)
- B·∫≠t OCR n·∫øu c√≥ t√†i li·ªáu scan/·∫£nh
- Nh·∫•n "X·ª≠ l√Ω & Vector h√≥a"
- H·ªá th·ªëng s·∫Ω:
  - Tr√≠ch xu·∫•t text t·ª´ PDF
  - Chia nh·ªè th√†nh chunks
  - T·∫°o embeddings
  - L∆∞u v√†o vector database

#### 3. ƒê·∫∑t c√¢u h·ªèi
- Nh·∫≠p c√¢u h·ªèi b·∫±ng ti·∫øng Vi·ªát
- Nh·∫≠n c√¢u tr·∫£ l·ªùi k√®m:
  - N·ªôi dung tr·∫£ l·ªùi ch√≠nh x√°c
  - Tr√≠ch d·∫´n ngu·ªìn [file:trang]
  - ƒê·ªô tin c·∫≠y (confidence score)
  - ƒêo·∫°n vƒÉn li√™n quan

### V√≠ d·ª• s·ª≠ d·ª•ng

```bash
# Health check
curl http://localhost:8000/healthz

# Upload file qua API
curl -X POST "http://localhost:8000/upload" \
  -H "Content-Type: multipart/form-data" \
  -F "files=@document.pdf" \
  -F "session_id=test-session"

# Ingest documents
curl -X POST "http://localhost:8000/ingest" \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "session_id=test-session&ocr=false"

# Ask question
curl -X POST "http://localhost:8000/ask" \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "session_id=test-session&query=N·ªôi dung ch√≠nh c·ªßa t√†i li·ªáu l√† g√¨?"
```

### API Endpoints

| Endpoint | Method | M√¥ t·∫£ |
|----------|--------|--------|
| `/` | GET | Trang ch·ªß web interface |
| `/upload` | POST | Upload PDF files |
| `/ingest` | POST | X·ª≠ l√Ω v√† vector h√≥a t√†i li·ªáu |
| `/ask` | POST | ƒê·∫∑t c√¢u h·ªèi |
| `/docs` | GET | Li·ªát k√™ t√†i li·ªáu ƒë√£ x·ª≠ l√Ω |
| `/healthz` | GET | Health check |

---

## üß™ Testing & Evaluation

### Test nhanh to√†n b·ªô workflow

```bash
# Ki·ªÉm tra server v√† workflow c∆° b·∫£n
python tests/simple_test.py
```

Script s·∫Ω th·ª±c hi·ªán:
- Health check server
- Upload file test
- Ingest t√†i li·ªáu
- Ch·∫°y c√°c c√¢u h·ªèi m·∫´u
- B√°o c√°o accuracy v√† latency

### Evaluation chi ti·∫øt

```bash
# Ch·∫°y evaluation v·ªõi test cases t·ª´ JSON
python tests/run_eval.py

# Ho·∫∑c v·ªõi session c√≥ s·∫µn
TEST_SESSION_ID=existing-session python tests/run_eval.py
```

### Customizing test cases

Ch·ªânh s·ª≠a `tests/eval_cases.json`:
```json
[
  {
    "q": "C√¢u h·ªèi c·ªßa b·∫°n?",
    "expected": ["t·ª´ kh√≥a 1", "t·ª´ kh√≥a 2", "t·ª´ kh√≥a 3"]
  }
]
```

### Performance Monitoring

Xem logs chi ti·∫øt:
```bash
# Logs ƒë∆∞·ª£c l∆∞u trong ./logs/
tail -f logs/rag_pdf_$(date +%Y%m%d).log
```

Metrics ƒë∆∞·ª£c theo d√µi:
- Request count v√† error rate
- Response time average/min/max
- Cache hit rate
- Token usage

---

## üîß ƒê√≥ng g√≥p & Ph√°t tri·ªÉn

### C·∫•u tr√∫c d·ª± √°n

```
rag-pdf/
‚îú‚îÄ‚îÄ app/                    # ·ª®ng d·ª•ng ch√≠nh
‚îÇ   ‚îú‚îÄ‚îÄ main.py            # FastAPI app initialization
‚îÇ   ‚îú‚îÄ‚îÄ routes.py          # API endpoints
‚îÇ   ‚îú‚îÄ‚îÄ rag/               # RAG engine
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pdf_loader.py  # PDF processing & OCR
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ chunking.py    # Text chunking logic
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ embeddings.py  # Embedding generation & cache
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ vectorstore.py # FAISS vector database
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hybrid.py      # Hybrid search (BM25 + Vector)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ rerank.py      # Cross-encoder reranking
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ generator.py   # Answer generation
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ answer_cache.py # Answer caching
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ cache.py       # Embedding cache utilities
‚îÇ   ‚îî‚îÄ‚îÄ utils/             # Utilities
‚îÇ       ‚îú‚îÄ‚îÄ config.py      # Configuration management
‚îÇ       ‚îú‚îÄ‚îÄ logger.py      # Structured logging
‚îÇ       ‚îú‚îÄ‚îÄ security.py    # Input validation & security
‚îÇ       ‚îú‚îÄ‚îÄ monitoring.py  # Error handling & metrics
‚îÇ       ‚îú‚îÄ‚îÄ rate_limiter.py # API rate limiting
‚îÇ       ‚îú‚îÄ‚îÄ schema.py      # Data models
‚îÇ       ‚îî‚îÄ‚îÄ hash.py        # Hashing utilities
‚îú‚îÄ‚îÄ static/                # Frontend assets
‚îÇ   ‚îú‚îÄ‚îÄ app.css           # Responsive UI styles
‚îÇ   ‚îî‚îÄ‚îÄ app.js            # Client-side logic
‚îú‚îÄ‚îÄ templates/             # HTML templates
‚îÇ   ‚îî‚îÄ‚îÄ index.html        # Main web interface
‚îú‚îÄ‚îÄ tests/                 # Test suite
‚îÇ   ‚îú‚îÄ‚îÄ eval_cases.json   # Test scenarios
‚îÇ   ‚îú‚îÄ‚îÄ simple_test.py    # Quick workflow test
‚îÇ   ‚îî‚îÄ‚îÄ run_eval.py       # Detailed evaluation
‚îú‚îÄ‚îÄ storage/               # Runtime data
‚îú‚îÄ‚îÄ uploads/               # Session-based file storage
‚îú‚îÄ‚îÄ logs/                  # Application logs
‚îú‚îÄ‚îÄ requirements.txt       # Python dependencies
‚îú‚îÄ‚îÄ .env.example          # Environment template
‚îî‚îÄ‚îÄ README.md             # Documentation
```

### Development Guidelines

#### Th√™m t√≠nh nƒÉng m·ªõi
1. Fork repository
2. T·∫°o feature branch: `git checkout -b feature/amazing-feature`
3. Implement v·ªõi tests
4. Commit: `git commit -m 'Add amazing feature'`
5. Push: `git push origin feature/amazing-feature`
6. T·∫°o Pull Request

#### Code Style
- Tu√¢n th·ªß PEP 8
- Type hints cho t·∫•t c·∫£ functions
- Docstrings cho modules v√† classes
- Error handling comprehensive

#### Testing
- Unit tests cho c√°c components ri√™ng l·∫ª
- Integration tests cho workflow
- Performance benchmarks

### Roadmap t√≠nh nƒÉng

#### Ng·∫Øn h·∫°n
- [ ] H·ªó tr·ª£ nhi·ªÅu ƒë·ªãnh d·∫°ng file (DOCX, TXT, RTF)
- [ ] C·∫£i thi·ªán UI/UX v·ªõi React frontend
- [ ] Export k·∫øt qu·∫£ ra PDF/Word
- [ ] Multi-language support

#### D√†i h·∫°n
- [ ] Vector database scaling (Qdrant, Weaviate)
- [ ] Fine-tuned embeddings cho ti·∫øng Vi·ªát
- [ ] Multi-modal support (images, tables)
- [ ] Collaborative features (sharing, comments)

---

## üìÑ Gi·∫•y ph√©p & Th√¥ng tin t√°c gi·∫£

### Th√¥ng tin d·ª± √°n

- **T√™n d·ª± √°n**: RAG PDF QA System
- **Sinh vi√™n**: L√™ ƒê√¨nh D≈©ng
- **MSSV**: 211240089
- **Email**: [ledinhdzung@gmail.com](mailto:ledinhdzung@gmail.com)
- **GitHub**: [@dungle03](https://github.com/dungle03)

### Th√¥ng tin h·ªçc t·∫≠p

- **M√¥n h·ªçc**: Chuy√™n ƒë·ªÅ C√¥ng ngh·ªá Th√¥ng tin - B√†i t·∫≠p l·ªõn
- **NƒÉm h·ªçc**: 2024-2025
- **Gi·∫£ng vi√™n h∆∞·ªõng d·∫´n**: Th·∫ßy B√πi Ng·ªçc D≈©ng
- **Tr∆∞·ªùng**: [T√™n tr∆∞·ªùng]

### Gi·∫•y ph√©p s·ª≠ d·ª•ng

D·ª± √°n ƒë∆∞·ª£c ph√°t tri·ªÉn cho m·ª•c ƒë√≠ch **h·ªçc t·∫≠p v√† nghi√™n c·ª©u**. 

#### ƒêi·ªÅu kho·∫£n s·ª≠ d·ª•ng:
- ‚úÖ S·ª≠ d·ª•ng cho m·ª•c ƒë√≠ch h·ªçc t·∫≠p
- ‚úÖ Tham kh·∫£o v√† h·ªçc h·ªèi
- ‚úÖ ƒê√≥ng g√≥p c·∫£i thi·ªán
- ‚ö†Ô∏è **Tr√≠ch d·∫´n ngu·ªìn** khi s·ª≠ d·ª•ng
- ‚ùå S·ª≠ d·ª•ng th∆∞∆°ng m·∫°i m√† kh√¥ng c√≥ s·ª± ƒë·ªìng √Ω

#### Tr√≠ch d·∫´n:
```
L√™ ƒê√¨nh D≈©ng (2024). RAG PDF QA System - H·ªá th·ªëng h·ªèi ƒë√°p t√†i li·ªáu PDF th√¥ng minh. 
B√†i t·∫≠p l·ªõn m√¥n Chuy√™n ƒë·ªÅ CNTT. 
GitHub: https://github.com/dungle03/rag-pdf
```

### Acknowledgments

C·∫£m ∆°n c√°c c√¥ng ngh·ªá v√† th∆∞ vi·ªán m√£ ngu·ªìn m·ªü:
- FastAPI team for the excellent web framework
- Google for Gemini AI APIs
- Facebook AI Research for FAISS
- Tesseract OCR community
- All contributors to the Python ecosystem

---

## üÜò H·ªó tr·ª£ & Troubleshooting

### C√°c l·ªói th∆∞·ªùng g·∫∑p

#### 1. API Key Issues
```bash
# L·ªói: "API key not valid"
# Gi·∫£i ph√°p: Ki·ªÉm tra API key trong .env
export GEMINI_API_KEY="your-actual-key"
uvicorn app.main:app --reload
```

#### 2. Tesseract OCR Issues
```bash
# L·ªói: "tesseract is not installed"
# Windows: C√†i ƒë·∫∑t t·ª´ official installer
# macOS: brew install tesseract  
# Linux: sudo apt-get install tesseract-ocr
```

#### 3. FAISS Installation Issues
```bash
# N·∫øu faiss-cpu l·ªói tr√™n Windows:
pip uninstall faiss-cpu
pip install faiss-cpu --no-cache-dir

# Ho·∫∑c chuy·ªÉn sang Chroma:
# Trong .env: VECTOR_STORE=chroma
```

#### 4. Memory Issues
```bash
# Gi·∫£m batch size cho embedding:
export EMBED_CONCURRENCY=2

# Gi·∫£m context window:
export CONTEXT_K=4
export RETRIEVE_TOP_K=8
```

### Li√™n h·ªá h·ªó tr·ª£

- **Issues**: [GitHub Issues](https://github.com/dungle03/rag-pdf/issues)
- **Email**: ledinhdzung@gmail.com
- **Documentation**: [Wiki](https://github.com/dungle03/rag-pdf/wiki)

---

**üéØ RAG PDF QA System - H·ªá th·ªëng h·ªèi ƒë√°p t√†i li·ªáu th√¥ng minh cho th·ªùi ƒë·∫°i AI!**---

## ‚ú® T√≠nh nƒÉng n·ªïi b·∫≠t

- **Upload nhi·ªÅu PDF**: ‚â§ 5 t·ªáp/l·∫ßn, ‚â§ 10MB/t·ªáp (t·ª± ƒë·ªông l·ªçc non-PDF).
- **Chunking th√¥ng minh**: 300‚Äì500 tokens, overlap 10‚Äì15%.
- **Embeddings**: Gemini `text-embedding-004`, c√≥ cache ƒë·ªÉ ti·∫øt ki·ªám API.
- **Vector Store**: FAISS/Chroma, h·ªó tr·ª£ MMR.
- **Hybrid Search**: BM25 + Vector (c√≥ th·ªÉ b·∫≠t/t·∫Øt, ƒëi·ªÅu ch·ªânh Œ±).
- **Reranker**: BGE reranker-base (tu·ª≥ ch·ªçn) ƒë·ªÉ tƒÉng ƒë·ªô ch√≠nh x√°c.
- **Sinh ƒë√°p**: Gemini 1.5 Flash, b·∫Øt bu·ªôc tr·∫£ l·ªùi k√®m citations.
- **Tr√≠ch d·∫´n th√¥ng minh**: [t√™n_file:trang] + confidence score + snippet.

---

## üõ°Ô∏è Production-Ready Features

- **Security**: Rate limiting, input validation, API key protection.
- **Monitoring**: Structured logging, error tracking, performance metrics.
- **Session Management**: M·ªói user c√°ch ly d·ªØ li·ªáu ri√™ng.
- **Caching**: Multi-layer (embeddings + answers) gi·∫£m 90% API calls.
- **OCR**: T√≠ch h·ª£p Tesseract ƒë·ªÉ x·ª≠ l√Ω PDF scan.
- **Error Handling**: X·ª≠ l√Ω ngo·∫°i l·ªá to√†n di·ªán.

---

## üèóÔ∏è Ki·∫øn tr√∫c h·ªá th·ªëng

```mermaid
flowchart LR
    U["Ng∆∞·ªùi d√πng"] -- "Upload PDF" --> S["FastAPI Backend"]
    S --> L["PDF Loader + OCR"]
    L --> C["Chunking"]
    C --> E["Embeddings (Gemini)"]
    E --> V["Vector Store (FAISS or Chroma)"]
    U -- "Query" --> Q["Ask Endpoint"]
    Q --> R1["Hybrid Retrieve"]
    R1 --> R2["Rerank (optional)"]
    R2 --> G["Gemini Generator"]
    G --> A["Answer + Citations"]
    A --> U
```

> N·∫øu v·∫´n g·∫∑p l·ªói render Mermaid tr√™n m·ªôt s·ªë viewer Markdown, h√£y xem file tr·ª±c ti·∫øp tr√™n GitHub (Mermaid ƒë∆∞·ª£c b·∫≠t s·∫µn) ho·∫∑c d√πng VS Code v·ªõi extension ‚ÄúMarkdown Preview Mermaid Support‚Äù.

---

## üìÇ C·∫•u tr√∫c d·ª± √°n

```
rag-pdf/
‚îú‚îÄ‚îÄ app/                # Core Application
‚îÇ   ‚îú‚îÄ‚îÄ main.py         # Kh·ªüi t·∫°o FastAPI
‚îÇ   ‚îú‚îÄ‚îÄ routes.py       # API endpoints (/upload, /ask, /ingest, /healthz)
‚îÇ   ‚îú‚îÄ‚îÄ rag/            # RAG engine modules
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pdf_loader.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ chunking.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ embeddings.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ vectorstore.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hybrid.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ rerank.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ generator.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ answer_cache.py
‚îÇ   ‚îî‚îÄ‚îÄ utils/          # Production utilities (config, logging, rate limiter‚Ä¶)
‚îú‚îÄ‚îÄ static/             # CSS & JS
‚îú‚îÄ‚îÄ templates/          # Jinja2 UI
‚îú‚îÄ‚îÄ tests/              # Test suite
‚îú‚îÄ‚îÄ storage/            # Vector store + cache
‚îú‚îÄ‚îÄ uploads/            # Session-based uploads
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ .env.example
‚îî‚îÄ‚îÄ README.md
```

---

## üîß C√†i ƒë·∫∑t & Tri·ªÉn khai

### 1. Y√™u c·∫ßu h·ªá th·ªëng
- Python **3.10 ‚Äì 3.12**  
- RAM ‚â• 4GB (khuy·∫øn ngh·ªã 8GB)  
- Storage ‚â• 2GB  
- API Key: Google AI Studio (Gemini API)  
- (Tu·ª≥ ch·ªçn) Tesseract OCR n·∫øu c·∫ßn ƒë·ªçc PDF scan

### 2. C√†i ƒë·∫∑t m√¥i tr∆∞·ªùng
```bash
# Clone project
git clone https://github.com/dungle03/rag-pdf.git
cd rag-pdf

# T·∫°o m√¥i tr∆∞·ªùng ·∫£o
python -m venv .venv
source .venv/bin/activate  # Linux/Mac
.\.venv\Scripts\Activate.ps1  # Windows

# C√†i dependencies
pip install -r requirements.txt
```

### 3. C·∫•u h√¨nh `.env`
```ini
GEMINI_API_KEY=your_gemini_api_key
RAG_EMBED_MODEL=text-embedding-004
RAG_LLM_MODEL=gemini-1.5-flash
VECTOR_STORE=faiss
MAX_FILES=5
MAX_FILE_MB=10
```

### 4. Ch·∫°y h·ªá th·ªëng
```bash
# Development
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

# Production
uvicorn app.main:app --host 0.0.0.0 --port 8000 --workers 4
```

---

## üöÄ S·ª≠ d·ª•ng

- Truy c·∫≠p `http://localhost:8000`  
- Upload 1‚Äì5 file PDF  
- Ingest d·ªØ li·ªáu (OCR optional)  
- ƒê·∫∑t c√¢u h·ªèi b·∫±ng ti·∫øng Vi·ªát ‚Üí Nh·∫≠n c√¢u tr·∫£ l·ªùi k√®m citations  

---

## üß™ Testing

```bash
# Test nhanh to√†n b·ªô flow
python tests/simple_test.py

# Evaluation chi ti·∫øt
python tests/run_eval.py
```

---

## üìä So s√°nh v·ªõi phi√™n b·∫£n g·ªëc

| T√≠nh nƒÉng        | Phi√™n b·∫£n g·ªëc | Enhanced Edition |
|------------------|---------------|------------------|
| B·∫£o m·∫≠t          | ‚ùå C∆° b·∫£n     | ‚úÖ Production-ready |
| Monitoring       | ‚ùå Kh√¥ng c√≥   | ‚úÖ Structured logging |
| Caching          | ‚ùå Kh√¥ng c√≥   | ‚úÖ Multi-layer |
| Testing          | ‚ùå Manual     | ‚úÖ Automated |
| Error Handling   | ‚ùå Basic      | ‚úÖ Robust |
| Hi·ªáu nƒÉng        | üî∏ Trung b√¨nh | ‚úÖ T·ªëi ∆∞u 50% |
| Kh·∫£ nƒÉng m·ªü r·ªông | üî∏ H·∫°n ch·∫ø    | ‚úÖ Enterprise-ready |

---

## üèÜ Th√¥ng tin d·ª± √°n

- **Sinh vi√™n**: L√™ ƒê√¨nh D≈©ng  
- **MSSV**: 211240089  
- **Email**: ledinhdzung@gmail.com  
- **GitHub**: [@dungle03](https://github.com/dungle03)  

**M√¥n h·ªçc**: Chuy√™n ƒë·ªÅ CNTT ‚Äì B√†i t·∫≠p l·ªõn  
**NƒÉm h·ªçc**: 2024‚Äì2025  
**GVHD**: Th·∫ßy B√πi Ng·ªçc D≈©ng  

---

## üìÑ License

D·ª± √°n ph·ª•c v·ª• m·ª•c ƒë√≠ch h·ªçc t·∫≠p & nghi√™n c·ª©u. Vui l√≤ng tu√¢n th·ªß quy ƒë·ªãnh tr√≠ch d·∫´n ngu·ªìn.

---

## ü§ù ƒê√≥ng g√≥p

1. T·∫°o **Issues** ƒë·ªÉ b√°o l·ªói ho·∫∑c ƒë·ªÅ xu·∫•t.  
2. G·ª≠i **Pull Requests** ƒë·ªÉ c·∫£i thi·ªán code.  
3. ƒê√≥ng g√≥p v√†o t√†i li·ªáu & test cases.  

---

**üéâ RAG PDF QA Enhanced Edition ‚Äì S·∫µn s√†ng cho Production!**
